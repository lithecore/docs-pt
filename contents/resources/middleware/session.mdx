---
title: Sessão  
description: O middleware de sessão no Lithe gerencia a configuração e o controle das sessões de usuário.  
---

## Instalação

Para instalar o middleware de sessão para o Lithe, use o comando de instalação do módulo Line:

```bash
php line module:install lithe-session
```

Este comando baixará e instalará o middleware de sessão em seu projeto.

## Usando o Middleware de Sessão

O Lithe inclui um middleware de sessão para gerenciar sessões de usuário e suas variáveis. Para configurar o middleware em sua aplicação, adicione-o usando o método `use()`:

```php
use Lithe\Middleware\Session\session;

$app->use(session());
```

Isso garante que a sessão seja iniciada e configurada corretamente para todas as requisições.

### Configurando o Middleware de Sessão

O middleware de sessão pode ser configurado com os seguintes parâmetros:

- **lifetime**: Define a duração da sessão em segundos. O padrão é 2592000 segundos (30 dias).
- **domain**: Define o domínio para o qual o cookie de sessão é válido. O padrão é `null`.
- **secure**: Indica se o cookie de sessão deve ser enviado apenas por conexões seguras (HTTPS). O padrão é `false`.
- **httponly**: Indica se o cookie de sessão deve ser acessível apenas através de requisições HTTP. O padrão é `true`.
- **samesite**: Define o atributo SameSite do cookie de sessão. Pode ser `'Lax'`, `'Strict'`, ou `'None'`. O padrão é `'Lax'`.
- **path**: Define o caminho onde os arquivos de sessão serão armazenados. O padrão é `'storage/framework/session'`.

Exemplo de configuração:

```php
$app->use(Session([
    'lifetime' => 3600,
    'domain' => 'example.com',
    'secure' => true,
    'httponly' => true,
    'samesite' => 'Strict',
    'path' => '../storage/framework/session',
]));
```

### Usando Variáveis de Sessão

Após a configuração, você pode acessar e manipular variáveis de sessão através do objeto `Request`. Aqui estão alguns métodos disponíveis:

- **put(string $name, mixed $value): void**

  Define uma variável de sessão.

  ```php
  $req->session->put('user', 'John Doe');
  ```

- **get(string $name, mixed $default = null): mixed**

  Recupera o valor de uma variável de sessão. Retorna o valor padrão se a variável não estiver definida.

  ```php
  $user = $req->session->get('user');
  ```

- **forget(mixed $name): void**

  Remove uma ou mais variáveis de sessão.

  ```php
  $req->session->forget('user');
  ```

- **destroy(): void**

  Destrói todas as variáveis de sessão.

  ```php
  $req->session->destroy();
  ```

- **isActive(): bool**

  Verifica se a sessão está ativa.

  ```php
  $isActive = $req->session->isActive();
  ```

- **regenerate(bool $deleteOldSession = true): bool**

  Regenera o ID da sessão. Se `$deleteOldSession` for `true`, a sessão antiga será deletada.

  ```php
  $req->session->regenerate();
  ```

- **getId(): string|false**

  Recupera o ID da sessão atual.

  ```php
  $sessionId = $req->session->getId();
  ```

- **setId(string $sessionId): bool**

  Define um novo ID para a sessão.

  ```php
  $req->session->setId('newSessionId');
  ```

- **all(): array**

  Recupera todas as variáveis de sessão.

  ```php
  $allSessionData = $req->session->all();
  ```

- **has(string|array $names): bool**

  Verifica se uma ou mais variáveis de sessão existem.

  ```php
  $hasUser = $req->session->has('user');
  ```

## Considerações

- **Criando o Diretório de Sessão**: O middleware garante que o diretório para armazenar sessões exista. Se não existir, ele será criado.
- **Tratamento de Erros**: Se ocorrer um erro durante a configuração ou inicialização da sessão, o middleware o registrará e continuará a execução.
