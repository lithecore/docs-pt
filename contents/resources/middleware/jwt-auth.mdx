---
title: JWT  
description: O middleware JWT (JSON Web Token) no Lithe permite a autenticação segura de usuários e a proteção de rotas específicas na sua aplicação.  
---

## Instalando o Middleware JWT

Para usar o middleware JWT no seu projeto Lithe, você precisa instalar o pacote `lithephp/jwt-auth`. Isso pode ser feito facilmente via Composer. Execute o seguinte comando no terminal:

```bash
composer require lithephp/jwt-auth
```

Após a instalação, você estará pronto para configurar e usar o middleware JWT na sua aplicação.

## Usando o Middleware JWT

O middleware JWT no Lithe é projetado para permitir a autenticação de usuários por meio de tokens JWT. Para configurá-lo, defina-o em sua aplicação usando uma instância do middleware e forneça o segredo e as opções de configuração:

```php
use Lithe\Middleware\Auth\JWT;

define('loggedIn', JWT('seu-segredo', [
    'alg' => 'HS256',                    // Algoritmo padrão
    'authHeader' => 'Authorization',     // Cabeçalho onde o token JWT será enviado
    'tokenPrefix' => 'Bearer',           // Prefixo do token no cabeçalho
    'leeway' => 60,                      // Tolerância de tempo
    'renew' => false,                    // Permitir renovação do token
    'renewThreshold' => 300,             // Renovar o token se faltar 5 minutos para expirar
]));
```

### Protegendo Rotas com Middleware JWT

Para proteger uma rota específica usando o middleware JWT, adicione `loggedIn` como um parâmetro na definição da rota:

```php
$app->get('/conta/', loggedIn, function ($req, $res) {
    $res->send('Conteúdo protegido acessado com sucesso!');
});
```

### Gerando e Verificando Tokens JWT

O middleware JWT oferece métodos para gerar e verificar tokens:

- **generateToken($user, $idKey = 'id', array $additionalClaims = []): string**  
  Gera um token JWT para um usuário específico. Você pode especificar a chave de ID do usuário e adicionar reivindicações adicionais ao payload.

  ```php
  $token = $req->jwt->generateToken($user);
  ```

### Renovando Tokens JWT

Se a opção `renew` estiver habilitada e o token estiver próximo da expiração, o middleware cuidará da renovação automaticamente ao verificar se o token está prestes a expirar. O novo token será incluído no cabeçalho da resposta se a renovação for necessária.

### Tratamento de Erros

Esteja preparado para lidar com exceções lançadas quando o token JWT for inválido ou estiver ausente. O middleware lançará um `HttpException` com o código 401 se o token não for fornecido ou for inválido.

## Considerações

- **Segurança**: O uso de tokens JWT aumenta a segurança ao permitir autenticação sem a necessidade de armazenar informações sensíveis no servidor. Assegure-se de manter seu segredo seguro.
- **Expiração de Tokens**: Configure um tempo de expiração adequado para seus tokens. Tokens expirados não serão aceitos, então tenha um plano de renovação em mente para uma boa experiência do usuário.
- **Tratamento de Erros**: Esteja preparado para lidar com exceções lançadas quando o token JWT for inválido ou estiver ausente. Isso pode incluir redirecionar para uma página de erro ou exibir uma mensagem apropriada para o usuário. Consulte a [documentação de Exceções HTTP](/docs/digging-deep/http-exceptions) para mais detalhes.
